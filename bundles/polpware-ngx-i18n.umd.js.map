{"version":3,"file":"polpware-ngx-i18n.umd.js","sources":["ng://@polpware/ngx-i18n/lib/services/resource-loader.service.ts","ng://@polpware/ngx-i18n/lib/services/ngx-translator-impl.service.ts","ng://@polpware/ngx-i18n/lib/services/utils.ts","ng://@polpware/ngx-i18n/lib/services/hyper-translator.pipe.ts","ng://@polpware/ngx-i18n/lib/ngx-i18n.module.ts"],"sourcesContent":["import { Injectable, NgZone } from '@angular/core';\r\n\r\nimport * as externalInterface from '@polpware/fe-dependencies';\r\nimport { replace } from '@polpware/fe-utilities';\r\n\r\nimport { loadJsonUriP } from '@polpware/fe-data';\r\nimport { I18n } from '@polpware/fe-data';\r\nimport { ResourceLoader } from '@polpware/fe-data';\r\n\r\nimport {\r\n    ISlidingExpireCache\r\n} from '@polpware/fe-data';\r\nimport {\r\n    SlidingExpirationCache\r\n} from '@polpware/fe-data';\r\n\r\nconst _ = externalInterface.underscore;\r\n\r\ninterface ILangOptionEntry {\r\n    code: string;\r\n    text: string;\r\n}\r\n\r\n/**\r\n * Verify if the given lang is valid. If the given lang is not valid,\r\n * this function returns a default one.\r\n * @private\r\n * @function validate\r\n * @param {Object} options The avaliable lang options.\r\n * @param {String} lang The requested lang code.\r\n * @returns {String} Verified lang code.\r\n */\r\nfunction validate(options: Array<ILangOptionEntry>, code: string) {\r\n    let lang = code || 'en-us';\r\n    const entry = _.find(options, e => e.code.substring(0, 2) === lang.substring(0, 2));\r\n    if (entry) {\r\n        lang = entry.code;\r\n    }\r\n\r\n    return lang;\r\n}\r\n\r\n\r\n@Injectable()\r\nexport class ResourceLoaderService {\r\n\r\n    private _resourceLoader: ResourceLoader;\r\n\r\n    constructor(ngZone: NgZone) {\r\n        const cache = new SlidingExpirationCache<any>(3 * 60, 5 * 60, ngZone);\r\n        this._resourceLoader = new ResourceLoader(cache);\r\n    }\r\n\r\n    public get resourceLoader() {\r\n        return this._resourceLoader;\r\n    }\r\n\r\n    /**\r\n     * Loads the dictionary for the given lang code.\r\n     * @function loadPromise\r\n     * @param {String} langCode The requested language code.\r\n     * @param {String}[] filter The optional language code which we are not interested in.\r\n     * @returns {Promise} The promise with the state of the loaded language dictionary.\r\n     * @throws {Error}\r\n     */\r\n    loadPromise(langCode: string, filter: string) {\r\n        const resourceLoader = this._resourceLoader;\r\n        return resourceLoader.getPromise<string>('lang.options', id => id)\r\n            .then(function(resolvedOptionsUrl) {\r\n                return loadJsonUriP(resolvedOptionsUrl);\r\n            })\r\n            .then(function(resolvedOptions) {\r\n                return validate(resolvedOptions, langCode);\r\n            })\r\n            .then(function(resolvedLangCode) {\r\n                if (resolvedLangCode === filter) {\r\n                    throw new Error('Loading the current language: ' + resolvedLangCode);\r\n                }\r\n                return resolvedLangCode;\r\n            })\r\n            .then(function(filteredLangCode) {\r\n                langCode = filteredLangCode;\r\n                return resourceLoader.getPromise<string>('lang.urlTmpl', id => id);\r\n            })\r\n            .then(function(resolvedUrlTmpl) {\r\n                return replace(resolvedUrlTmpl, { code: langCode });\r\n            })\r\n            .then(function(resolvedUrl) {\r\n                return loadJsonUriP(resolvedUrl);\r\n            })\r\n            .then(function(resolvedData) {\r\n                I18n.add(resolvedData.code, resolvedData.items);\r\n                I18n.recycleOthers(resolvedData.code);\r\n                return resolvedData;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Load lang options\r\n     * @function loadOptionPromise\r\n     * @returns {Promise}\r\n     */\r\n    loadOptionPromise() {\r\n        return this._resourceLoader.getPromise('lang.options', id => id)\r\n            .then(function(resolvedOptionsUrl) {\r\n                return loadJsonUriP(resolvedOptionsUrl);\r\n            });\r\n    }\r\n}\r\n","import { EventEmitter } from \"@angular/core\";\nimport { Observable, of } from \"rxjs\";\nimport { DefaultLangChangeEvent, INgxTranslator, LangChangeEvent, TranslationChangeEvent } from '../interfaces/ngx-translator.interface';\n\n\n/* On purpose we do not make it injectable. \n   It is up to the host to define how to do this */\n\nexport class NgxTranslatorImplService implements INgxTranslator {\n\n\n    private _dict: { [key: string]: any } = {};\n\n    onTranslationChange: EventEmitter<TranslationChangeEvent> = new EventEmitter<TranslationChangeEvent>();\n    onLangChange: EventEmitter<LangChangeEvent> = new EventEmitter<LangChangeEvent>();\n    onDefaultLangChange: EventEmitter<DefaultLangChangeEvent> = new EventEmitter<DefaultLangChangeEvent>();\n\n    defaultLang = '';\n\n    currentLang = '';\n\n    langs = [];\n\n    public getParsedResult(translations: any, key: any, interpolateParams?: Object): any {\n        return key;\n    }\n\n    public get(key: string | Array<string>, interpolateParams?: Object): Observable<string | any> {\n        // Get\n        let ks: Array<string> = [];\n        if (typeof key == 'string') {\n            ks = key.split('.');\n        } else {\n            ks = key as Array<string>;\n        }\n\n        ks = ks.filter(a => a);\n\n        let res = this._dict;\n        for (let i = 0; i < ks.length; i++) {\n            const c = ks[i];\n            if (res[c]) {\n                res = res[c];\n            }\n            else {\n                res = undefined;\n                break;\n            }\n        }\n\n        const v = res !== undefined ? res : key;\n        return of(v);\n    }\n\n    public loadResources(resources: { [key: string]: any }) {\n        // todo: A better implementation\n        Object.assign(this._dict, resources);\n    }\n}\n","/* tslint:disable */\r\n/**\r\n * Determines if two objects or two values are equivalent.\r\n *\r\n * Two objects or values are considered equivalent if at least one of the following is true:\r\n *\r\n * * Both objects or values pass `===` comparison.\r\n * * Both objects or values are of the same type and all of their properties are equal by\r\n *   comparing them with `equals`.\r\n *\r\n * @param o1 Object or value to compare.\r\n * @param o2 Object or value to compare.\r\n * @returns true if arguments are equal.\r\n */\r\nexport function equals(o1: any, o2: any): boolean {\r\n    if (o1 === o2) return true;\r\n    if (o1 === null || o2 === null) return false;\r\n    if (o1 !== o1 && o2 !== o2) return true; // NaN === NaN\r\n    let t1 = typeof o1, t2 = typeof o2, length: number, key: any, keySet: any;\r\n    if (t1 == t2 && t1 == 'object') {\r\n        if (Array.isArray(o1)) {\r\n            if (!Array.isArray(o2)) return false;\r\n            if ((length = o1.length) == o2.length) {\r\n                for (key = 0; key < length; key++) {\r\n                    if (!equals(o1[key], o2[key])) return false;\r\n                }\r\n                return true;\r\n            }\r\n        } else {\r\n            if (Array.isArray(o2)) {\r\n                return false;\r\n            }\r\n            keySet = Object.create(null);\r\n            for (key in o1) {\r\n                if (!equals(o1[key], o2[key])) {\r\n                    return false;\r\n                }\r\n                keySet[key] = true;\r\n            }\r\n            for (key in o2) {\r\n                if (!(key in keySet) && typeof o2[key] !== 'undefined') {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n/* tslint:enable */\r\n\r\nexport function isDefined(value: any): boolean {\r\n    return typeof value !== 'undefined' && value !== null;\r\n}\r\n\r\nexport function isObject(item: any): boolean {\r\n    return (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\nexport function mergeDeep(target: any, source: any): any {\r\n    let output = Object.assign({}, target);\r\n    if (isObject(target) && isObject(source)) {\r\n        Object.keys(source).forEach((key: any) => {\r\n            if (isObject(source[key])) {\r\n                if (!(key in target)) {\r\n                    Object.assign(output, { [key]: source[key] });\r\n                } else {\r\n                    output[key] = mergeDeep(target[key], source[key]);\r\n                }\r\n            } else {\r\n                Object.assign(output, { [key]: source[key] });\r\n            }\r\n        });\r\n    }\r\n    return output;\r\n}\r\n","import { ChangeDetectorRef, Injectable, OnDestroy, Pipe, PipeTransform } from '@angular/core';\r\nimport { isObservable, Subscription } from 'rxjs';\r\nimport { LangChangeEvent, TranslationChangeEvent } from '../interfaces/ngx-translator.interface';\r\nimport { NgxTranslatorImplService } from './ngx-translator-impl.service';\r\nimport { equals, isDefined } from './utils';\r\n\r\n@Injectable()\r\n@Pipe({\r\n    name: 'hyperTrans',\r\n    pure: false // required to update the value when the promise is resolved\r\n})\r\nexport class HyperTranslatePipe implements PipeTransform, OnDestroy {\r\n    value: string = '';\r\n    lastKey: string | null = null;\r\n    lastParams: any[] = [];\r\n    onTranslationChange: Subscription | undefined;\r\n    onLangChange: Subscription | undefined;\r\n    onDefaultLangChange: Subscription | undefined;\r\n\r\n    constructor(private translate: NgxTranslatorImplService, private _ref: ChangeDetectorRef) {\r\n    }\r\n\r\n    updateValue(key: string, interpolateParams?: Object, translations?: any): void {\r\n        let onTranslation = (res: string) => {\r\n            this.value = res !== undefined ? res : key;\r\n            this.lastKey = key;\r\n            this._ref.markForCheck();\r\n        };\r\n        if (translations) {\r\n            let res = this.translate.getParsedResult(translations, key, interpolateParams);\r\n            if (isObservable(res.subscribe)) {\r\n                res.subscribe(onTranslation);\r\n            } else {\r\n                onTranslation(res);\r\n            }\r\n        }\r\n        this.translate.get(key, interpolateParams).subscribe(onTranslation);\r\n    }\r\n\r\n    transform(query: string, ...args: any[]): any {\r\n        if (!query || !query.length) {\r\n            return query;\r\n        }\r\n\r\n        // if we ask another time for the same key, return the last value\r\n        if (equals(query, this.lastKey) && equals(args, this.lastParams)) {\r\n            return this.value;\r\n        }\r\n\r\n        let interpolateParams: Object | undefined = undefined;\r\n        if (isDefined(args[0]) && args.length) {\r\n            if (typeof args[0] === 'string' && args[0].length) {\r\n                // we accept objects written in the template such as {n:1}, {'n':1}, {n:'v'}\r\n                // which is why we might need to change it to real JSON objects such as {\"n\":1} or {\"n\":\"v\"}\r\n                let validArgs: string = args[0]\r\n                    .replace(/(\\')?([a-zA-Z0-9_]+)(\\')?(\\s)?:/g, '\"$2\":')\r\n                    .replace(/:(\\s)?(\\')(.*?)(\\')/g, ':\"$3\"');\r\n                try {\r\n                    interpolateParams = JSON.parse(validArgs);\r\n                } catch (e) {\r\n                    throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${args[0]}`);\r\n                }\r\n            } else if (typeof args[0] === 'object' && !Array.isArray(args[0])) {\r\n                interpolateParams = args[0];\r\n            }\r\n        }\r\n\r\n        // store the query, in case it changes\r\n        this.lastKey = query;\r\n\r\n        // store the params, in case they change\r\n        this.lastParams = args;\r\n\r\n        // set the value\r\n        this.updateValue(query, interpolateParams);\r\n\r\n        // if there is a subscription to onLangChange, clean it\r\n        this._dispose();\r\n\r\n        // subscribe to onTranslationChange event, in case the translations change\r\n        if (!this.onTranslationChange) {\r\n            this.onTranslationChange = this.translate.onTranslationChange.subscribe((event: TranslationChangeEvent) => {\r\n                if (this.lastKey && event.lang === this.translate.currentLang) {\r\n                    this.lastKey = null;\r\n                    this.updateValue(query, interpolateParams, event.translations);\r\n                }\r\n            });\r\n        }\r\n\r\n        // subscribe to onLangChange event, in case the language changes\r\n        if (!this.onLangChange) {\r\n            this.onLangChange = this.translate.onLangChange.subscribe((event: LangChangeEvent) => {\r\n                if (this.lastKey) {\r\n                    this.lastKey = null; // we want to make sure it doesn't return the same value until it's been updated\r\n                    this.updateValue(query, interpolateParams, event.translations);\r\n                }\r\n            });\r\n        }\r\n\r\n        // subscribe to onDefaultLangChange event, in case the default language changes\r\n        if (!this.onDefaultLangChange) {\r\n            this.onDefaultLangChange = this.translate.onDefaultLangChange.subscribe(() => {\r\n                if (this.lastKey) {\r\n                    this.lastKey = null; // we want to make sure it doesn't return the same value until it's been updated\r\n                    this.updateValue(query, interpolateParams);\r\n                }\r\n            });\r\n        }\r\n\r\n        return this.value;\r\n    }\r\n\r\n    /**\r\n     * Clean any existing subscription to change events\r\n     */\r\n    private _dispose(): void {\r\n        if (typeof this.onTranslationChange !== 'undefined') {\r\n            this.onTranslationChange.unsubscribe();\r\n            this.onTranslationChange = undefined;\r\n        }\r\n        if (typeof this.onLangChange !== 'undefined') {\r\n            this.onLangChange.unsubscribe();\r\n            this.onLangChange = undefined;\r\n        }\r\n        if (typeof this.onDefaultLangChange !== 'undefined') {\r\n            this.onDefaultLangChange.unsubscribe();\r\n            this.onDefaultLangChange = undefined;\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        this._dispose();\r\n    }\r\n}\r\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { HyperTranslatePipe } from './services/hyper-translator.pipe';\n\n@NgModule({\n    declarations: [HyperTranslatePipe],\n    imports: [\n        CommonModule,\n    ],\n    exports: [HyperTranslatePipe]\n})\nexport class NgxI18nModule { }\n"],"names":["externalInterface.underscore","SlidingExpirationCache","ResourceLoader","loadJsonUriP","replace","I18n","Injectable","EventEmitter","of","isObservable","Pipe","CommonModule","NgModule"],"mappings":"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"}